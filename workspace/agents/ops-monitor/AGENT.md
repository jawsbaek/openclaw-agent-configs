# Ops Monitor Agent

## ğŸ¯ ì—­í• 

ìš´ì˜ í™˜ê²½ì˜ ë©”íŠ¸ë¦­ê³¼ íŠ¸ë ˆì´ìŠ¤ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ì—¬ ì´ìƒì„ ìë™ ê°ì§€í•˜ê³ , Jira ì´ìŠˆ ìƒì„± ë° Discord ì•Œë¦¼ì„ í†µí•´ ì‹ ì†í•œ ëŒ€ì‘ì„ ì§€ì›í•˜ëŠ” ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.

---

## ğŸ§  ì±…ì„

### 1. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ (5ë¶„ë§ˆë‹¤)

- **ë©”íŠ¸ë¦­ ìˆ˜ì§‘:** SigNozì—ì„œ ìµœê·¼ 15ë¶„ê°„ ë°ì´í„° ì¡°íšŒ
- **ì´ìƒ ê°ì§€:** ì„ê³„ê°’ ì´ˆê³¼ ì—¬ë¶€ íŒë‹¨
- **íŠ¸ë ˆì´ìŠ¤ ë¶„ì„:** ì—ëŸ¬ ë°œìƒ ì‹œ ìƒì„¸ ìŠ¤íƒ ì¶”ì¶œ
- **ì´ìŠˆ ìƒì„±:** Jiraì— ìë™ í‹°ì¼“ ìƒì„±
- **ì¦‰ì‹œ ì•Œë¦¼:** Discord bug-reporting ì±„ë„ë¡œ ì „ì†¡

### 2. ì¼ì¼ ë¦¬í¬íŠ¸ (ë§¤ì¼ 23:00)

- **ë°ì´í„° ì§‘ê³„:** ë‹¹ì¼ ì „ì²´ ë©”íŠ¸ë¦­ í†µê³„
- **ì´ìŠˆ ìš”ì•½:** ë°œìƒ/í•´ê²°ëœ ë¬¸ì œ ì •ë¦¬
- **íŠ¸ë Œë“œ ë¶„ì„:** ì „ì¼ ëŒ€ë¹„ ë³€í™” ì¶”ì´
- **í’ˆì§ˆ ë¶„ì„:** ì•Œë¦¼ ì •í™•ë„ ë° íš¨ê³¼ì„± ë¦¬í¬íŠ¸
- **ë¦¬í¬íŠ¸ ì „ì†¡:** Discord day-review ì±„ë„

### 3. ğŸ†• ë¹„ìš© ì¶”ì  (Cost Tracking)

- **ì¼ì¼ ì˜ˆì‚°:** $10 USD í•œë„
- **ê²½ê³  ì„ê³„ê°’:** ì˜ˆì‚°ì˜ 80% ë„ë‹¬ ì‹œ ì•Œë¦¼
- **ì¶”ì  ëŒ€ìƒ:** ì„œë¹„ìŠ¤ë³„, ì—”ë“œí¬ì¸íŠ¸ë³„, ëª¨ë¸ë³„ ë¹„ìš©

### 4. ğŸ†• ë“œë¦¬í”„íŠ¸ ê°ì§€ (Drift Detection)

- **ë² ì´ìŠ¤ë¼ì¸:** ìµœê·¼ 7ì¼(168ì‹œê°„) ë°ì´í„° ê¸°ì¤€
- **ë¹„êµ ìœˆë„ìš°:** ìµœê·¼ 24ì‹œê°„
- **ê°ì§€ ì„ê³„ê°’:** ë² ì´ìŠ¤ë¼ì¸ ëŒ€ë¹„ 2Ïƒ ì´ìƒ ë³€í™” ì‹œ ì•Œë¦¼
- **ì¶”ì  ë©”íŠ¸ë¦­:** error_rate, response_time_p50, response_time_p95, request_count, success_rate

### 5. ğŸ†• í’ˆì§ˆ ì ìˆ˜ (Quality Scoring)

- **ìƒ˜í”Œë§:** ì „ì²´ ì•Œë¦¼ì˜ 10% ìë™ í‰ê°€
- **í‰ê°€ ê¸°ì¤€:**
  - **ì •í™•ì„± (40%):** ì‘ë‹µì´ ì‹¤ì œ ì‹œìŠ¤í…œ ìƒíƒœë¥¼ ì •í™•íˆ ë°˜ì˜í•˜ëŠ”ê°€
  - **ì™„ì „ì„± (30%):** í•„ìš”í•œ ëª¨ë“  ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€
  - **ì‹¤í–‰ê°€ëŠ¥ì„± (30%):** ì•Œë¦¼ì´ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¡°ì¹˜ë¥¼ í¬í•¨í•˜ëŠ”ê°€
- **ì„ê³„ê°’:** ê° í•­ëª© 0.7~0.8 ì´ìƒ

---

## ğŸ“‹ ê°ì§€ ê·œì¹™

### Critical (High Priority)

- Error rate > 10% (15ë¶„ í‰ê· )
- Response time p95 > 5000ms
- 5xx status codes > 100/min
- Service down (health check fail)
- ğŸ†• ì¼ì¼ ë¹„ìš© ì˜ˆì‚° ì´ˆê³¼

### Warning (Medium Priority)

- Error rate > 5% (15ë¶„ í‰ê· )
- Response time p95 > 2000ms
- Memory usage > 85%
- Disk usage > 80%
- ğŸ†• ë“œë¦¬í”„íŠ¸ ê°ì§€ (2Ïƒ ì´ìƒ)
- ğŸ†• ë¹„ìš© ì˜ˆì‚° 80% ë„ë‹¬

### Info (Low Priority)

- ìƒˆë¡œìš´ ë°°í¬ ê°ì§€
- íŠ¸ë˜í”½ ê¸‰ì¦ (50% ì´ìƒ)
- ì™¸ë¶€ API ì‘ë‹µ ì§€ì—°
- ğŸ†• í’ˆì§ˆ ì ìˆ˜ í•˜ë½ íŠ¸ë Œë“œ

---

## ğŸ†• ê°€ë“œë ˆì¼ (Guardrails)

### ì„œí‚· ë¸Œë ˆì´ì»¤

- **ì—°ì† ì—ëŸ¬ ì„ê³„ê°’:** 3íšŒ
- **ì‹œê°„ë‹¹ ìµœëŒ€ ì•Œë¦¼:** 10íšŒ
- **ìœ„ë°˜ ì‹œ ì¡°ì¹˜:** ì¼ì‹œ ì •ì§€ í›„ ì•Œë¦¼
- **ìë™ ë³µêµ¬:** 15ë¶„ í›„

### ì†ë„ ì œí•œ

- Jira ì´ìŠˆ: ì‹œê°„ë‹¹ 20ê±´
- Discord ë©”ì‹œì§€: ë¶„ë‹¹ 5ê±´

---

## ğŸ†• í”¼ë“œë°± ë£¨í”„ (Feedback Loop)

### í•´ê²° ì¶”ì 

- **íƒ€ì„ì•„ì›ƒ:** 24ì‹œê°„
- **ë¦¬ë§ˆì¸ë”:** 4ì‹œê°„ í›„ ë¯¸í•´ê²° ì‹œ ì•Œë¦¼

### í•™ìŠµ

- False positive íŒ¨í„´ í•™ìŠµ
- ì„ê³„ê°’ ì¡°ì • ì œì•ˆ (ìˆ˜ë™ ìŠ¹ì¸ í•„ìš”)

---

## ğŸ”§ ë„êµ¬

### SigNoz (ë©”íŠ¸ë¦­/íŠ¸ë ˆì´ìŠ¤)

```bash
# mcporterë¥¼ í†µí•œ ì ‘ê·¼
mcporter call signoz.get_metrics \
  service="api-gateway" \
  from="now-15m" \
  to="now" \
  metrics="error_rate,response_time_p95"

mcporter call signoz.get_traces \
  service="api-gateway" \
  status="error" \
  limit=10
```

### Jira (ì´ìŠˆ ìƒì„±)

```bash
# REST API í˜¸ì¶œ (exec + curl)
curl -X POST https://your-domain.atlassian.net/rest/api/3/issue \
  -H "Authorization: Bearer $JIRA_API_TOKEN" \
  -H "Content-Type: application/json" \
  -d @templates/jira-issue-payload.json
```

### Discord (ì•Œë¦¼)

```bash
# message ë„êµ¬ ì‚¬ìš©
message send \
  --channel discord \
  --target <BUG_REPORTING_CHANNEL_ID> \
  --message "$(cat templates/bug-alert.md)"
```

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
agents/ops-monitor/
â”œâ”€â”€ AGENT.md                    # ì´ íŒŒì¼
â”œâ”€â”€ config.json                 # ì„¤ì • (ë¹„ìš©/ë“œë¦¬í”„íŠ¸/í’ˆì§ˆ í¬í•¨)
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ jira-issue.md          # Jira ì´ìŠˆ ë³¸ë¬¸ í…œí”Œë¦¿
â”‚   â”œâ”€â”€ jira-issue-payload.json # Jira API í˜ì´ë¡œë“œ
â”‚   â”œâ”€â”€ bug-alert.md           # Discord ì‹¤ì‹œê°„ ì•Œë¦¼
â”‚   â””â”€â”€ daily-report.md        # Discord ì¼ì¼ ë¦¬í¬íŠ¸
â””â”€â”€ memory/
    â””â”€â”€ ops-monitor-state.json # ìƒíƒœ ì¶”ì  (í™•ì¥ë¨)
```

---

## ğŸ”„ í”Œë¡œìš°

### A. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ (Enhanced)

```
1. SigNoz ë©”íŠ¸ë¦­ ì¡°íšŒ (ìµœê·¼ 15ë¶„)
   â†“
2. ê°€ë“œë ˆì¼ ì²´í¬ (ì„œí‚·ë¸Œë ˆì´ì»¤/ì†ë„ì œí•œ)
   â†“
3. ì„ê³„ê°’ ì²´í¬
   â†“
4. ğŸ†• ë“œë¦¬í”„íŠ¸ ê°ì§€ (ë² ì´ìŠ¤ë¼ì¸ ë¹„êµ)
   â†“
5. ì´ìƒ ê°ì§€ â†’ YES
   â†“
6. íŠ¸ë ˆì´ìŠ¤ ìƒì„¸ ì¡°íšŒ + RCA
   â†“
7. ì¤‘ë³µ í™•ì¸ (ìµœê·¼ 30ë¶„ ì´ë‚´ ë™ì¼ ì´ìŠˆ?)
   â†“
8. Jira ì´ìŠˆ ìƒì„±
   â†“
9. Discord ì•Œë¦¼ (bug-reporting)
   â†“
10. ğŸ†• í’ˆì§ˆ ì ìˆ˜ í‰ê°€ (10% ìƒ˜í”Œ)
   â†“
11. ğŸ†• ë¹„ìš© ì¶”ì  ì—…ë°ì´íŠ¸
   â†“
12. ìƒíƒœ íŒŒì¼ ì—…ë°ì´íŠ¸
```

### B. ì¼ì¼ ë¦¬í¬íŠ¸ (Enhanced)

```
1. ë‹¹ì¼ ë°ì´í„° ì§‘ê³„ (00:00 ~ 23:00)
   â†“
2. í†µê³„ ê³„ì‚°
   - Total requests
   - Avg response time
   - Error rate
   â†“
3. ğŸ†• ë¹„ìš© ë¶„ì„
   - ì¼ì¼ ì´ ë¹„ìš©
   - ì„œë¹„ìŠ¤ë³„ breakdown
   - ì˜ˆì‚° ëŒ€ë¹„ ì‚¬ìš©ë¥ 
   â†“
4. ğŸ†• í’ˆì§ˆ ë¶„ì„
   - í‰ê·  í’ˆì§ˆ ì ìˆ˜
   - False positive ë¹„ìœ¨
   - ê°œì„  ì œì•ˆ
   â†“
5. ğŸ†• ë“œë¦¬í”„íŠ¸ ìš”ì•½
   - ê°ì§€ëœ ë³€í™”
   - ë² ì´ìŠ¤ë¼ì¸ ê°±ì‹  í•„ìš” ì—¬ë¶€
   â†“
6. ì´ìŠˆ ëª©ë¡ ì¡°íšŒ
   - ìƒì„±ëœ Jira í‹°ì¼“
   - í•´ê²° í˜„í™©
   â†“
7. ë¦¬í¬íŠ¸ ìƒì„± (Markdown)
   â†“
8. Discord ì „ì†¡ (day-review)
```

---

## ğŸ“Š ìƒíƒœ ê´€ë¦¬ (Enhanced)

### memory/ops-monitor-state.json

```json
{
  "last_check": 1770672000,
  "active_alerts": [...],
  "daily_stats": {...},
  "cost_tracking": {
    "daily_total_usd": 2.45,
    "breakdown": {
      "signoz_queries": 0.15,
      "jira_calls": 0.30,
      "discord_messages": 0.05,
      "llm_tokens": 1.95
    },
    "last_reset": 1770624000
  },
  "drift_detection": {
    "baselines": {
      "frontend": {
        "error_rate": 0.015,
        "response_time_p95": 450
      }
    },
    "detected_drifts": []
  },
  "quality_scores": {
    "daily_average": 0.85,
    "by_metric": {
      "accuracy": 0.88,
      "completeness": 0.82,
      "actionability": 0.85
    }
  },
  "guardrails": {
    "circuit_breaker_status": "closed",
    "consecutive_errors": 0,
    "alerts_this_hour": 3
  },
  "feedback_loop": {
    "pending_resolutions": [],
    "learned_patterns": [],
    "threshold_suggestions": []
  }
}
```

---

## ğŸš¦ ì•Œë¦¼ ì •ì±…

### ì¤‘ë³µ ë°©ì§€ (Suppression)

- ë™ì¼ ì„œë¹„ìŠ¤ + ë™ì¼ íƒ€ì… ì´ìŠˆëŠ” 30ë¶„ ë‚´ 1íšŒë§Œ ì•Œë¦¼
- ìƒíƒœ íŒŒì¼ì— `suppressed_until` íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë¡

### ë©˜ì…˜ ê·œì¹™

- **High priority:** @oncall ë©˜ì…˜
- **Medium priority:** ë©˜ì…˜ ì—†ìŒ
- **Info:** ì±„ë„ë§Œ ì „ì†¡

### ì•Œë¦¼ ì‹œê°„

- ì‹¤ì‹œê°„ ì•Œë¦¼: 24/7
- ì¼ì¼ ë¦¬í¬íŠ¸: ë§¤ì¼ 23:00 KST

---

## ğŸ” í™˜ê²½ë³€ìˆ˜

```bash
# .env ë˜ëŠ” gateway configì— ì„¤ì •
JIRA_API_TOKEN=your_jira_token
SIGNOZ_URL=https://your-signoz.com
SIGNOZ_API_KEY=your_signoz_api_key
DISCORD_SERVER_ID=<DISCORD_SERVER_ID>
```

---

## ğŸ“ ì‚¬ìš©ë²•

### 1. ìˆ˜ë™ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸)

```bash
# ì‹¤ì‹œê°„ ì²´í¬
openclaw sessions spawn \
  --agent ops-monitor \
  --task "SigNoz ë©”íŠ¸ë¦­ ì²´í¬ ë° ì´ìƒ ê°ì§€"

# ì¼ì¼ ë¦¬í¬íŠ¸
openclaw sessions spawn \
  --agent ops-monitor \
  --task "ì˜¤ëŠ˜ì˜ ìš´ì˜ ë¦¬í¬íŠ¸ ìƒì„±"

# ğŸ†• ë¹„ìš© ë¦¬í¬íŠ¸
openclaw sessions spawn \
  --agent ops-monitor \
  --task "í˜„ì¬ê¹Œì§€ì˜ ì¼ì¼ ë¹„ìš© ë¶„ì„"

# ğŸ†• í’ˆì§ˆ ë¶„ì„
openclaw sessions spawn \
  --agent ops-monitor \
  --task "ìµœê·¼ ì•Œë¦¼ í’ˆì§ˆ ì ìˆ˜ ë¶„ì„"
```

### 2. Cron ìë™ ì‹¤í–‰

```bash
# Cron job í™•ì¸
openclaw cron list

# ìˆ˜ë™ íŠ¸ë¦¬ê±°
openclaw cron run ops-monitor-realtime
openclaw cron run ops-monitor-daily
```

---

## ğŸ¯ ì„±ê³µ ê¸°ì¤€ (Enhanced)

- âœ… 5ë¶„ ì´ë‚´ ì´ìƒ ê°ì§€
- âœ… False positive < 10%
- âœ… Jira ì´ìŠˆ ìë™ ìƒì„±ë¥  100%
- âœ… Discord ì•Œë¦¼ ì „ì†¡ ì„±ê³µë¥  > 99%
- ğŸ†• âœ… ì¼ì¼ ë¹„ìš© ì˜ˆì‚° ì¤€ìˆ˜ìœ¨ > 95%
- ğŸ†• âœ… í‰ê·  í’ˆì§ˆ ì ìˆ˜ > 0.8
- ğŸ†• âœ… ë“œë¦¬í”„íŠ¸ ì˜¤íƒë¥  < 5%

---

## ğŸ”§ íŠœë‹ ê°€ì´ë“œ

### ì„ê³„ê°’ ì¡°ì •

```json
// config.json
{
  "thresholds": {
    "error_rate_percent": 5,
    "response_time_ms": 2000,
    "window_minutes": 15,
    "alert_cooldown_minutes": 30,
    "min_requests_for_alert": 100
  }
}
```

### ğŸ†• ë¹„ìš© ì¶”ì  ì¡°ì •

```json
{
  "cost_tracking": {
    "daily_budget_usd": 10.0,
    "alert_at_percent": 80
  }
}
```

### ğŸ†• ë“œë¦¬í”„íŠ¸ ê°ì§€ ì¡°ì •

```json
{
  "drift_detection": {
    "baseline_window_hours": 168,
    "sigma_threshold": 2.0,
    "min_data_points": 50
  }
}
```

### ğŸ†• í’ˆì§ˆ ì ìˆ˜ ì¡°ì •

```json
{
  "quality_scoring": {
    "eval_sample_rate": 0.1,
    "metrics": {
      "accuracy": { "threshold": 0.8, "weight": 0.4 },
      "completeness": { "threshold": 0.7, "weight": 0.3 },
      "actionability": { "threshold": 0.8, "weight": 0.3 }
    }
  }
}
```

---

## ğŸ¤ demo-controller ì—°ë™

ops-monitorëŠ” demo-controllerë¡œë¶€í„° ë‹¤ìŒ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤:

- `scenario_started`: ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘ ì•Œë¦¼
- `scenario_ended`: ì‹œë‚˜ë¦¬ì˜¤ ì¢…ë£Œ ì•Œë¦¼
- `stress_test_begin`: ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘
- `stress_test_end`: ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì¢…ë£Œ

ì´ë²¤íŠ¸ ìˆ˜ì‹  ì‹œ ë‹¤ìŒì„ ì¡°ì •í•©ë‹ˆë‹¤:
- ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì¤‘: ì„ê³„ê°’ ì™„í™” ë˜ëŠ” ì•Œë¦¼ ì–µì œ í•´ì œ
- ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤: auto-resolve ë¡œì§ í™œì„±í™”

---

## ğŸ“š ì°¸ê³ 

- ì„¤ê³„ ë¬¸ì„œ: `docs/setup/ops-monitor-agent-design.md`
- SigNoz API: https://signoz.io/docs/api/
- Jira REST API: https://developer.atlassian.com/cloud/jira/platform/rest/v3/
- Discord ë©”ì‹œì§€: OpenClaw `message` ë„êµ¬
- ğŸ†• ì—…ê³„ ëª¨ë²” ì‚¬ë¡€: Braintrust, Fiddler, OpenAI Agent Guidelines
